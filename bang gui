-- OP BANG GUI
-- By ERROR_USERBANNED/Shadow_Sadist

-- Function to search for partial name matches
local function findPlayerByPartialName(partialName)
    partialName = partialName:lower()

    for _, player in ipairs(game.Players:GetPlayers()) do
        local lowerName = player.Name:lower()
        if string.sub(lowerName, 1, #partialName) == partialName then
            return player
        end
    end

    return nil -- If no match is found
end

-- Create the GUI to input the player's name
local playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PlayerNameGUI"
screenGui.Parent = playerGui

local background = Instance.new("Frame")
background.Size = UDim2.new(0, 300, 0, 150)
background.Position = UDim2.new(0.5, -150, 0.5, -75)
background.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
background.BackgroundTransparency = 0.5
background.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(240, 240, 240)
title.Text = "BANG GUI"
title.TextScaled = true
title.Parent = background

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(1, 0, 0, 40)
textBox.Position = UDim2.new(0, 0, 0, 40)
textBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
textBox.TextColor3 = Color3.fromRGB(240, 240, 240)
textBox.PlaceholderText = "Player name or partial name"
textBox.TextScaled = true
textBox.Parent = background

local enterButton = Instance.new("TextButton")
enterButton.Size = UDim2.new(1, 0, 0, 40)
enterButton.Position = UDim2.new(0, 0, 0, 90)
enterButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0) -- Green button
enterButton.TextColor3 = Color3.fromRGB(255, 255, 255)
enterButton.Text = "Enter"
enterButton.TextScaled = true
enterButton.Parent = background

-- Close button ("X") in the upper-right corner
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- Red button to close
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Text = "X"
closeButton.TextScaled = true
closeButton.Parent = background

-- Close the GUI when "X" is clicked
closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Notification at the start
game.StarterGui:SetCore("SendNotification", {
    Title = "OP FE BANG",
    Text = "By ERROR_USERBANNED",
    Duration = 3
})

-- Connect the button to execute the bang command with the entered name (or part of the name)
enterButton.MouseButton1Click:Connect(function()
    local partialName = textBox.Text

    if partialName and partialName ~= "" then
        local targetPlayer = findPlayerByPartialName(partialName)

        if targetPlayer then
            -- Execute the bang command with the found player's name
            execBangCommand(game.Players.LocalPlayer, targetPlayer.Name)

            -- Optional: Change the title text if the player is found
            title.Text = "Player found: " .. targetPlayer.Name
        else
            -- If no player is found, show an error message
            title.Text = "Player not found"
        end
    else
        -- If no name is entered, show an error message
        title.Text = "Please enter a valid name"
    end
end)

-- Function to execute the bang command
function execBangCommand(speaker, targetName)
    execCmd("unbang")
    wait()

    local humanoid = speaker.Character and speaker.Character:FindFirstChildWhichIsA("Humanoid")
    if not humanoid then return end  -- Ensure humanoid exists

    local bangAnim = Instance.new("Animation")
    bangAnim.AnimationId = not r15(speaker) and "rbxassetid://148840371" or "rbxassetid://5918726674"
    local bang = humanoid:LoadAnimation(bangAnim)
    bang:Play(0.1, 1, 1)
    bang:AdjustSpeed(3)

    bangDied = humanoid.Died:Connect(function()
        bang:Stop()
        bangAnim:Destroy()
        bangDied:Disconnect()
    end)

    -- Adjust player positioning
    local targetPlayer = game.Players:FindFirstChild(targetName)
    if targetPlayer and targetPlayer.Character then
        local bangOffset = CFrame.new(0, 0, 1.1)
        local bangLoop = RunService.Stepped:Connect(function()
            local otherRoot = getTorso(targetPlayer.Character)
            getRoot(speaker.Character).CFrame = otherRoot.CFrame * bangOffset
        end)
    end
end

-- Make the GUI draggable
local dragging
local dragInput
local dragStart
local startPos

background.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = background.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

background.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        if dragging then
            local delta = input.Position - dragStart
            background.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
end)
